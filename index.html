<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Horilla Dev Setup Generator | Automate Your HRMS Workspace</title>
    <meta name="description"
        content="Generate production-ready setup and maintenance scripts for Horilla HRMS development. Automate database wipes, migrations, and environment configuration.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --background: #09090b;
            --foreground: #fafafa;
            --card: #09090b;
            --card-foreground: #fafafa;
            --popover: #09090b;
            --popover-foreground: #fafafa;
            --primary: #fafafa;
            --primary-foreground: #18181b;
            --secondary: #27272a;
            --secondary-foreground: #fafafa;
            --muted: #27272a;
            --muted-foreground: #a1a1aa;
            --accent: #27272a;
            --accent-foreground: #fafafa;
            --destructive: #ef4444;
            --destructive-foreground: #fafafa;
            --border: #27272a;
            --input: #27272a;
            --ring: #d4d4d8;
            --radius: 0.5rem;

            --success: #22c55e;
            --warning: #f59e0b;
            --info: #3b82f6;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--background);
            color: var(--foreground);
            line-height: 1.5;
            padding: 40px 20px;
            -webkit-font-smoothing: antialiased;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 48px;
            text-align: left;
        }

        h1 {
            font-size: 36px;
            font-weight: 700;
            letter-spacing: -0.025em;
            margin-bottom: 8px;
        }

        .header-subtitle {
            color: var(--muted-foreground);
            font-size: 16px;
        }

        .layout {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
            margin-top: 32px;
        }

        .panel {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 24px;
        }

        .panel h2 {
            margin-bottom: 20px;
            font-size: 20px;
            font-weight: 600;
            letter-spacing: -0.02em;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
        }

        input[type="text"],
        input[type="password"],
        input[type="number"],
        select {
            width: 100%;
            padding: 10px 12px;
            background-color: transparent;
            border: 1px solid var(--input);
            border-radius: var(--radius);
            color: var(--foreground);
            font-family: inherit;
            font-size: 14px;
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        input:focus,
        select:focus {
            outline: none;
            border-color: var(--ring);
            box-shadow: 0 0 0 2px rgba(255, 255, 255, 0.1);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-top: 12px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        input[type="checkbox"] {
            width: 16px;
            height: 16px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .help-text {
            font-size: 13px;
            color: var(--muted-foreground);
            margin-top: 6px;
        }

        .button-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        button {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 500;
            padding: 10px 16px;
            cursor: pointer;
            transition: opacity 0.2s, background-color 0.2s;
            border: 1px solid transparent;
        }

        .btn-primary {
            background-color: var(--primary);
            color: var(--primary-foreground);
            flex: 1;
        }

        .btn-primary:hover {
            opacity: 0.9;
        }

        .btn-secondary {
            background-color: var(--secondary);
            color: var(--secondary-foreground);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background-color: var(--accent);
        }

        .btn-copy,
        .btn-download {
            padding: 6px 10px;
            font-size: 12px;
        }

        .output-section {
            grid-column: 1 / -1;
            margin-top: 16px;
        }

        .code-block {
            background-color: #0c0c0e;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 16px;
            position: relative;
            margin: 16px 0;
            overflow: hidden;
        }

        .code-block pre {
            font-family: 'JetBrains Mono', 'Menlo', 'Monaco', monospace;
            font-size: 13px;
            line-height: 1.6;
            color: #e4e4e7;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
        }

        .code-actions {
            position: absolute;
            top: 12px;
            right: 12px;
            display: flex;
            gap: 8px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .code-block:hover .code-actions {
            opacity: 1;
        }

        .tabs {
            display: flex;
            gap: 4px;
            padding: 4px;
            background: #18181b;
            border-radius: var(--radius);
            margin-bottom: 24px;
        }

        .tab-btn {
            flex: 1;
            padding: 8px;
            background: transparent;
            border: none;
            color: var(--muted-foreground);
            border-radius: 4px;
            font-size: 13px;
        }

        .tab-btn.active {
            background: var(--background);
            color: var(--foreground);
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
        }

        .feature-list {
            list-style: none;
        }

        .feature-list li {
            font-size: 14px;
            color: var(--muted-foreground);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-list li::before {
            content: "→";
            color: var(--foreground);
        }

        .alert {
            padding: 16px;
            border-radius: var(--radius);
            font-size: 14px;
            border: 1px solid var(--border);
            margin-bottom: 24px;
        }

        .alert-info {
            background: #172554;
            border-color: #1e3a8a;
            color: #bfdbfe;
        }

        .alert-success {
            background: #052e16;
            border-color: #064e3b;
            color: #6ee7b7;
        }

        .alert-warning {
            background: #451a03;
            border-color: #78350f;
            color: #fde68a;
        }

        .divider {
            height: 1px;
            background-color: var(--border);
            margin: 32px 0;
        }

        @media (max-width: 768px) {
            .layout {
                grid-template-columns: 1fr;
            }
        }

        .copy-feedback {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: var(--primary);
            color: var(--primary-foreground);
            padding: 12px 20px;
            border-radius: var(--radius);
            font-size: 14px;
            font-weight: 600;
            opacity: 0;
            transform: translateY(10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            pointer-events: none;
            z-index: 100;
        }

        .copy-feedback.show {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Horilla Dev Setup Generator</h1>
            <p class="header-subtitle">Automated workspace scripts for Horilla HRMS development</p>
        </header>

        <div class="alert alert-info">
            <strong>Functionality:</strong> Creates reusable shell scripts that automate the entire Horilla setup
            process. Ideal for dropping and recreating your environment after code changes. Based on official
            Horilla 1.0 documentation.
        </div>

        <div class="layout">
            <div class="panel">
                <h2>Configuration</h2>

                <div class="form-group">
                    <label for="projectPath">Project Path</label>
                    <input type="text" id="projectPath" value="~/dev/horilla" placeholder="/home/user/projects/horilla">
                    <p class="help-text">Local path where Horilla is or will be cloned</p>
                </div>

                <div class="form-group">
                    <label for="venvName">Virtual Environment Name</label>
                    <input type="text" id="venvName" value="horillavenv" placeholder="horillavenv">
                    <p class="help-text">Name of the directory for Python isolation</p>
                </div>

                <div class="form-group">
                    <label for="dbType">Database Type</label>
                    <select id="dbType" onchange="updateDbFields()">
                        <option value="sqlite">SQLite (Development)</option>
                        <option value="postgresql">PostgreSQL (Production-like)</option>
                    </select>
                </div>

                <div id="postgresFields" style="display: none;">
                    <div class="form-group">
                        <label for="dbName">Database Name</label>
                        <input type="text" id="dbName" value="horilla_dev">
                    </div>

                    <div class="form-group">
                        <label for="dbUser">Database User</label>
                        <input type="text" id="dbUser" value="horilla_user">
                    </div>

                    <div class="form-group">
                        <label for="dbPass">Database Password</label>
                        <input type="password" id="dbPass" value="dev_password_123">
                    </div>

                    <div class="form-group">
                        <label for="dbHost">Database Host</label>
                        <input type="text" id="dbHost" value="localhost">
                    </div>

                    <div class="form-group">
                        <label for="dbPort">Database Port</label>
                        <input type="number" id="dbPort" value="5432">
                    </div>
                </div>

                <div class="divider"></div>

                <div class="form-group">
                    <label>Features</label>
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="loadDemo" checked>
                            <label for="loadDemo" style="margin: 0;">Load Demo Data</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="createSuper" checked>
                            <label for="createSuper" style="margin: 0;">Create Superuser</label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="runServer" checked>
                            <label for="runServer" style="margin: 0;">Auto-run Server</label>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="adminUser">Admin Username</label>
                    <input type="text" id="adminUser" value="admin">
                </div>

                <div class="form-group">
                    <label for="adminEmail">Admin Email</label>
                    <input type="text" id="adminEmail" value="admin@horilla.local">
                </div>

                <div class="form-group">
                    <label for="adminPass">Admin Password</label>
                    <input type="password" id="adminPass" value="admin123">
                </div>

                <div class="form-group">
                    <label for="serverPort">Server Port</label>
                    <input type="number" id="serverPort" value="8000">
                </div>

                <div class="button-group">
                    <button class="btn-primary" onclick="generateScripts()">Generate Scripts</button>
                    <button class="btn-secondary" onclick="resetForm()">Reset</button>
                </div>
            </div>

            <div class="panel">
                <h2>Productivity</h2>

                <h3 style="font-size: 14px; margin-bottom: 12px; font-weight: 600;">Core Benefits</h3>
                <ul class="feature-list">
                    <li>Eliminates repetitive manual setup steps</li>
                    <li>Drops and recreates DB in seconds</li>
                    <li>Consistent dev environment every time</li>
                    <li>Supports rapid iteration after code changes</li>
                </ul>

                <div class="divider"></div>

                <h3 style="font-size: 14px; margin-bottom: 12px; font-weight: 600;">Standard Workflow</h3>
                <div class="alert alert-success">
                    1. Run setup.sh once to initialize<br>
                    2. Perform code changes<br>
                    3. Run fresh-db.sh to reset if needed<br>
                    4. Run dev-server.sh to start
                </div>

                <div class="alert alert-warning">
                    <strong>Notice:</strong> Review scripts before execution. Verify project paths and database
                    credentials conform to your local environment.
                </div>
            </div>

            <div class="panel output-section" id="outputSection" style="display: none;">
                <div class="tabs">
                    <button class="tab-btn active" onclick="switchTab(event, 'setup')">setup.sh</button>
                    <button class="tab-btn" onclick="switchTab(event, 'fresh')">fresh-db.sh</button>
                    <button class="tab-btn" onclick="switchTab(event, 'server')">dev-server.sh</button>
                    <button class="tab-btn" onclick="switchTab(event, 'env')">.env</button>
                </div>

                <div id="setup" class="tab-content active">
                    <p style="font-size: 14px; color: var(--muted-foreground); margin-bottom: 20px;">Initialize your
                        complete Horilla development environment.</p>
                    <div class="code-block">
                        <div class="code-actions">
                            <button class="btn-secondary" onclick="copyCode('setupCode')">Copy</button>
                            <button class="btn-primary"
                                onclick="downloadFile('setupCode', 'setup.sh')">Download</button>
                        </div>
                        <pre id="setupCode"></pre>
                    </div>
                </div>

                <div id="fresh" class="tab-content">
                    <p style="font-size: 14px; color: var(--muted-foreground); margin-bottom: 20px;">Drop and recreate
                        everything for a clean state after code changes.</p>
                    <div class="code-block">
                        <div class="code-actions">
                            <button class="btn-secondary" onclick="copyCode('freshCode')">Copy</button>
                            <button class="btn-primary"
                                onclick="downloadFile('freshCode', 'fresh-db.sh')">Download</button>
                        </div>
                        <pre id="freshCode"></pre>
                    </div>
                </div>

                <div id="server" class="tab-content">
                    <p style="font-size: 14px; color: var(--muted-foreground); margin-bottom: 20px;">Launcher for the
                        Django development server.</p>
                    <div class="code-block">
                        <div class="code-actions">
                            <button class="btn-secondary" onclick="copyCode('serverCode')">Copy</button>
                            <button class="btn-primary"
                                onclick="downloadFile('serverCode', 'dev-server.sh')">Download</button>
                        </div>
                        <pre id="serverCode"></pre>
                    </div>
                </div>

                <div id="env" class="tab-content">
                    <p style="font-size: 14px; color: var(--muted-foreground); margin-bottom: 20px;">Environment
                        variable template for your project root.</p>
                    <div class="code-block">
                        <div class="code-actions">
                            <button class="btn-secondary" onclick="copyCode('envCode')">Copy</button>
                            <button class="btn-primary"
                                onclick="downloadFile('envCode', '.env.example')">Download</button>
                        </div>
                        <pre id="envCode"></pre>
                    </div>
                </div>

                <div class="alert alert-info" style="margin-top: 32px;">
                    <h3 style="font-size: 16px; margin-bottom: 12px; color: inherit;">Quick Execution</h3>

                    <p class="help-text" style="margin-bottom: 8px;">1. Make scripts executable:</p>
                    <div class="code-block" style="background: rgba(255,255,255,0.03); margin: 0 0 16px 0;">
                        <button class="btn-secondary"
                            style="position: absolute; right: 8px; top: 8px; font-size: 11px; padding: 4px 8px;"
                            onclick="copyCode('cmdChmod')">Copy</button>
                        <pre id="cmdChmod"
                            style="margin: 0; font-size: 12px;">chmod +x setup.sh fresh-db.sh dev-server.sh</pre>
                    </div>

                    <p class="help-text" style="margin-bottom: 8px;">2. Run initial setup:</p>
                    <div class="code-block" style="background: rgba(255,255,255,0.03); margin: 0 0 16px 0;">
                        <button class="btn-secondary"
                            style="position: absolute; right: 8px; top: 8px; font-size: 11px; padding: 4px 8px;"
                            onclick="copyCode('cmdSetup')">Copy</button>
                        <pre id="cmdSetup" style="margin: 0; font-size: 12px;">./setup.sh</pre>
                    </div>

                    <p class="help-text" style="margin-bottom: 8px;">3. Deploy changes:</p>
                    <div class="code-block" style="background: rgba(255,255,255,0.03); margin: 0;">
                        <button class="btn-secondary"
                            style="position: absolute; right: 8px; top: 8px; font-size: 11px; padding: 4px 8px;"
                            onclick="copyCode('cmdDeploy')">Copy</button>
                        <pre id="cmdDeploy"
                            style="margin: 0; font-size: 12px;">git add . && git commit -m "Update" && git push origin main</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="copy-feedback" id="copyFeedback">✓ Copied to clipboard</div>

    <script>
        function updateDbFields() {
            const dbType = document.getElementById('dbType').value;
            document.getElementById('postgresFields').style.display = dbType === 'postgresql' ? 'block' : 'none';
        }

        function switchTab(e, tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            e.target.classList.add('active');
        }

        function generateScripts() {
            const projectPath = document.getElementById('projectPath').value || '~/dev/horilla';
            const venvName = document.getElementById('venvName').value || 'horillavenv';
            const dbType = document.getElementById('dbType').value;
            const loadDemo = document.getElementById('loadDemo').checked;
            const createSuper = document.getElementById('createSuper').checked;
            const runServer = document.getElementById('runServer').checked;
            const adminUser = document.getElementById('adminUser').value || 'admin';
            const adminEmail = document.getElementById('adminEmail').value || 'admin@horilla.local';
            const adminPass = document.getElementById('adminPass').value || 'admin123';
            const serverPort = document.getElementById('serverPort').value || '8000';

            let setupScript = generateSetupScript(projectPath, venvName, dbType, loadDemo, createSuper, runServer, adminUser, adminEmail, adminPass, serverPort);
            let freshScript = generateFreshDbScript(projectPath, venvName, dbType, loadDemo, createSuper, adminUser, adminEmail, adminPass, serverPort);
            let serverScript = generateServerScript(projectPath, venvName, serverPort);
            let envFile = generateEnvFile(dbType);

            document.getElementById('setupCode').textContent = setupScript;
            document.getElementById('freshCode').textContent = freshScript;
            document.getElementById('serverCode').textContent = serverScript;
            document.getElementById('envCode').textContent = envFile;

            // Show output section
            document.getElementById('outputSection').style.display = 'block';

            showFeedback("Scripts generated successfully!", true);
        }

        function showFeedback(message, isGen = false) {
            const feedback = document.getElementById('copyFeedback');
            feedback.textContent = message;
            feedback.className = 'copy-feedback show' + (isGen ? ' gen-feedback' : '');
            setTimeout(() => feedback.classList.remove('show'), 3000);
        }

        function downloadFile(elementId, filename) {
            const content = document.getElementById(elementId).textContent;
            const blob = new Blob([content], { type: 'text/x-sh' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function generateSetupScript(projectPath, venvName, dbType, loadDemo, createSuper, runServer, adminUser, adminEmail, adminPass, serverPort) {
            let script = `#!/bin/bash

# Horilla HRMS - Complete Development Setup Script
# Official documentation: https://github.com/horilla-opensource/horilla
# Generated: $(date)

set -e  # Exit on error

# Check for required tools
command -v python3 >/dev/null 2>&1 || { echo "Python3 required but not found. Exiting."; exit 1; }
command -v git >/dev/null 2>&1 || { echo "Git required but not found. Exiting."; exit 1; }

PROJECT_PATH="${projectPath}"
VENV_NAME="${venvName}"

echo "Starting Horilla development setup..."
echo "Project path: \${PROJECT_PATH}"
echo ""

# Ensure we are in the right directory
mkdir -p "\${PROJECT_PATH}"
cd "\${PROJECT_PATH}"

# Check if repo already cloned
if [ ! -f "manage.py" ]; then
    echo "Cloning Horilla repository from official source..."
    git clone https://github.com/horilla-opensource/horilla.git .
else
    echo "Horilla repository already exists"
fi

# Create virtual environment if needed
if [ ! -d "$VENV_NAME" ]; then
    echo "Creating Python virtual environment..."
    python3 -m venv "$VENV_NAME"
else
    echo "Virtual environment already exists"
fi

# Activate virtual environment
echo "Activating virtual environment..."
source "$VENV_NAME/bin/activate"

# Upgrade pip and install dependencies
echo "Upgrading pip..."
python3 -m pip install --upgrade pip

if [ -f "requirements.txt" ]; then
    echo "Installing dependencies..."
    python3 -m pip install -r requirements.txt || { echo "Failed to install dependencies. Check your internet connection."; exit 1; }
fi

# Initialize environment file
if [ ! -f ".env" ]; then
    echo "Creating .env..."
    cp .env.example .env 2>/dev/null || echo "DEBUG=True" > .env
fi

# Database setup
if [ -f "manage.py" ]; then
    echo "Running migrations..."
    python3 manage.py makemigrations # Generate migration files
    python3 manage.py migrate        # Apply migrations to DB
else
    echo "manage.py not found. Are you in the correct directory?"
    exit 1
fi

`;

            if (dbType === 'postgresql') {
                script += `
# PostgreSQL specific setup
echo "PostgreSQL database configured in .env"
echo "   Make sure PostgreSQL is running locally or update .env with correct credentials"
`;
            }

            if (loadDemo) {
                script += `
# Load initial demo data
if [ -f "fixtures/initial_data.json" ] || python3 manage.py loaddata initial_data --help >/dev/null 2>&1; then
    echo "Loading demo data..."
    python3 manage.py loaddata initial_data 2>/dev/null || echo "Note: Demo data fixture not found or already loaded"
fi
`;
            }

            if (createSuper) {
                script += `
# Create administrator account
echo "Creating admin user..."
# Try Horilla-specific creation command, fallback to standard createsuperuser
python3 manage.py createhorillauser --noinput --username="${adminUser}" --email="${adminEmail}" --password="${adminPass}" 2>/dev/null || \
python3 manage.py createsuperuser --noinput --username="${adminUser}" --email="${adminEmail}" 2>/dev/null || \
echo "Could not create superuser automatically. You may need to run it manually."
echo "   Target credentials: ${adminUser} / ${adminPass}"
`;
            }

            script += `
echo ""
echo "Setup complete!"
echo ""
echo "Next steps:"
`;

            if (runServer) {
                script += `echo "   1. Run: ./dev-server.sh"`;
            } else {
                script += `echo "   1. Run: python manage.py runserver 0.0.0.0:${serverPort}"`;
            }

            script += `
echo "   2. Open: http://localhost:${serverPort}"
echo "   3. Navigate to /admin for admin panel"
echo ""
echo "Development tip: Use './fresh-db.sh' after code changes to reset database"
`;

            return script;
        }

        function generateFreshDbScript(projectPath, venvName, dbType, loadDemo, createSuper, adminUser, adminEmail, adminPass, serverPort) {
            let script = `#!/bin/bash

# Horilla HRMS - Fresh Database Reset Script
# Use this when you modify models and need to start fresh
# Official commands follow Horilla 1.0 documentation

set -e  # Exit on error

PROJECT_PATH="${projectPath}"
VENV_NAME="${venvName}"

echo "This will DROP your database and recreate it fresh"
if [[ "$1" != "--force" ]]; then
    read -p "Are you sure? (type 'yes' to continue): " confirm
    if [ "$confirm" != "yes" ]; then
        echo "Cancelled."
        exit 0
    fi
fi

# Check for required tools
command -v python3 >/dev/null 2>&1 || { echo "Python3 required but not found. Exiting."; exit 1; }

cd "$PROJECT_PATH"

# Activate environment
if [ -d "$VENV_NAME" ]; then
    echo "Activating virtual environment..."
    source "$VENV_NAME/bin/activate"
else
    echo "Virtual environment '$VENV_NAME' not found. Run setup.sh first."
    exit 1
fi

echo ""
echo "Cleaning up old database and migration files..."
`;

            if (dbType === 'sqlite') {
                script += `
# Remove SQLite database
rm -f db.sqlite3
echo "   Removed db.sqlite3"
`;
            } else {
                script += `
# Drop PostgreSQL database (requires .env or manual setup)
echo "   Note: PostgreSQL database will need manual drop or Django will skip"
echo "   Run: psql -U horilla_user -d horilla_dev -c 'DROP SCHEMA public CASCADE; CREATE SCHEMA public;'"
`;
            }

            script += `
# Remove pycache and migrations
find . -type d -name "__pycache__" -exec rm -rf {} + 2>/dev/null || true
find . -type d -name "migrations" -path "*/apps/*" -exec rm -rf {} + 2>/dev/null || true
echo "   Cleaned __pycache__ and old migrations"

# Generate and apply new migrations
echo "Running fresh migrations..."
python3 manage.py makemigrations # Detect code changes
python3 manage.py migrate        # Apply to database

`;

            if (loadDemo) {
                script += `
# Load initial demo data
if [ -f "fixtures/initial_data.json" ] || python3 manage.py loaddata initial_data --help >/dev/null 2>&1; then
    echo "Loading demo data..."
    python3 manage.py loaddata initial_data 2>/dev/null || echo "Note: Demo data fixture skipped or unavailable"
fi
`;
            }

            if (createSuper) {
                script += `
# Recreate administrative user
echo "Creating admin user..."
python3 manage.py createhorillauser --noinput --username="${adminUser}" --email="${adminEmail}" --password="${adminPass}" 2>/dev/null || \
python3 manage.py createsuperuser --noinput --username="${adminUser}" --email="${adminEmail}" 2>/dev/null || \
echo "Superuser creation skipped or failed."
`;
            }

            script += `
echo ""
echo "Fresh database ready!"
echo ""
echo "Next: Run ./dev-server.sh to start development"
`;

            return script;
        }

        function generateServerScript(projectPath, venvName, serverPort) {
            return `#!/bin/bash

# Horilla HRMS - Development Server Launcher
# Quick start for the Django development server

PROJECT_PATH="${projectPath}"
VENV_NAME="${venvName}"

cd "$PROJECT_PATH"

# Activate virtual environment if not already active
if [ -z "$VIRTUAL_ENV" ]; then
    source "$VENV_NAME/bin/activate"
fi

echo "Starting Horilla development server..."
echo "Access at: http://localhost:${serverPort}"
echo "Press Ctrl+C to stop"
echo ""

# Start the Django development server
if [ -f "manage.py" ]; then
    # 0.0.0.0 allows access from other devices on the network
    python3 manage.py runserver 0.0.0.0:${serverPort}
else
    echo "manage.py not found. Please run this from the project root."
    exit 1
fi
`;
        }

        function generateEnvFile(dbType) {
            if (dbType === 'postgresql') {
                return `# Horilla HRMS Development Environment Variables
# Configure database and application settings

# Database Configuration (PostgreSQL)
DATABASE_ENGINE=django.db.backends.postgresql
DATABASE_NAME=horilla_dev
DATABASE_USER=horilla_user
DATABASE_PASSWORD=dev_password_123
DATABASE_HOST=localhost
DATABASE_PORT=5432

# Django Settings
DEBUG=True
SECRET_KEY=your-insecure-secret-key-for-development-only
ALLOWED_HOSTS=localhost,127.0.0.1

# Email Configuration (optional)
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend

# Additional Settings
SECURE_SSL_REDIRECT=False
SESSION_COOKIE_SECURE=False
CSRF_COOKIE_SECURE=False
`;
            } else {
                return `# Horilla HRMS Development Environment Variables
# Configure database and application settings

# Database Configuration (SQLite - default)
# SQLite is configured automatically in Django settings
# No additional database configuration needed

# Django Settings
DEBUG=True
SECRET_KEY=your-insecure-secret-key-for-development-only
ALLOWED_HOSTS=localhost,127.0.0.1

# Email Configuration (optional)
EMAIL_BACKEND=django.core.mail.backends.console.EmailBackend

# Additional Settings
SECURE_SSL_REDIRECT=False
SESSION_COOKIE_SECURE=False
CSRF_COOKIE_SECURE=False
`;
            }
        }

        function copyCode(elementId) {
            const code = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(code).then(() => {
                showFeedback("Copied to clipboard");
            });
        }

        function resetForm() {
            document.querySelectorAll('input[type="text"], input[type="password"], input[type="number"], select').forEach(el => {
                el.value = el.defaultValue;
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(el => {
                el.checked = el.defaultChecked;
            });
            updateDbFields();
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            updateDbFields();
        });
    </script>
</body>

</html>