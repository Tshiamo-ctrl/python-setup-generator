============================= test session starts ==============================
platform linux -- Python 3.12.3, pytest-9.0.2, pluggy-1.6.0 -- /home/tmo/Documents/dev/Horilla_setup_generator_app/test_venv/bin/python3
cachedir: .pytest_cache
rootdir: /home/tmo/Documents/dev/Horilla_setup_generator_app
plugins: playwright-0.7.2, base-url-2.1.0
collecting ... collected 1 item

tests/test_generator.py::test_error_handling_trap[chromium] <- ../../../Downloads/Horilla setup generator app/tests/test_generator.py FAILED [100%]

=================================== FAILURES ===================================
______________________ test_error_handling_trap[chromium] ______________________

page_on_index = <Page url='file:///home/tmo/Documents/dev/Horilla_setup_generator_app/index.html'>

>   ???
E   assert 'trap \'echo "Error encountered at line $LINENO"; exit 1\' ERR' in '#!/bin/bash\n# repo - Development Setup Script\n# Generated: $(date)\n# Enhanced with defensive error handling and fallbacks\n\nset -euo pipefail\ntrap \'echo "\u274c Error encountered at line $LINENO. Exit code: $?" >&2; \n      echo "\U0001f527 Troubleshooting:" >&2\n      echo "  - Check internet connection for git clone" >&2\n      echo "  - Verify Python and pip are working" >&2\n      echo "  - Ensure disk space is available" >&2\n      exit 1\' ERR\n\n# Enhanced error recovery\ntrap \'echo "\u26a0\ufe0f  Script interrupted. Cleaning up..."; \n      # Kill any background processes\n      jobs -p | xargs -r kill 2>/dev/null || true;\n      exit 130\' INT TERM\n\n# --- Configuration with validation ---\nREPO_URL="https://github.com/test/repo.git"\nPROJECT_PATH="~/dev/my-project"\nVENV_NAME="venv"\nCUSTOM_REQ_PATH=""\nCUSTOM_INSTALL_CMD=""\nSCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"\n\n# Validate critical configuration\nif [[ -z "$REPO_URL" ]]; then\n    echo "\u274c ERROR: Repository URL is required" >&2\n    exit 1\nfi\n\nif [[ -z "$PROJECT_PATH" ]]; then\n    echo "\u274c ERROR: Project path is required" >&2\n    exit 1\nfi\n\necho "\U0001f680 Starting setup for repo..."\necho "\U0001f4cd Target directory: $PROJECT_PATH"\n\n# --- Enhanced system checks ---\ncheck_command() {\n    local cmd="$1"\n    local name="$2"\n    local install_hint="$3"\n    \n    if ! command -v "$cmd" >/dev/null 2>&1; then\n        echo "\u274c ERROR: $name is required but not found." >&2\n        if [[ -n "$install_hint" ]]; then\n            echo "\U0001f4a1 Install hint: $install_hint" >&2\n        fi\n        exit 1\n    else\n        echo "\u2705 Found: $name ($(command -v "$cmd"))"\n    fi\n}\n\n# Essential commands\ncheck_command "python3" "Python 3" "sudo apt install python3 python3-pip python3-venv"\ncheck_command "git" "Git" "sudo apt install git"\n\n# Optional but recommended\nif [ -f "package.json" ]; then\n    check_command "npm" "Node.js/NPM" "curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash - && sudo apt install nodejs"\nfi\n\n# Check disk space (minimum 2GB)\ncheck_disk_space() {\n    local required_gb=2\n    local available_gb=$(df . | tail -1 | awk \'{print int($4/1024/1024)}\')\n    \n    if [[ $available_gb -lt $required_gb ]]; then\n        echo "\u26a0\ufe0f  WARNING: Low disk space (${available_gb}GB available, ${required_gb}GB recommended)"\n        echo "   Setup may fail due to insufficient space." >&2\n        read -p "Continue anyway? (y/N): " -n 1 -r\n        echo\n        if [[ ! $REPLY =~ ^[Yy]$ ]]; then\n            echo "Setup cancelled by user."\n            exit 0\n        fi\n    else\n        echo "\u2705 Sufficient disk space available (${available_gb}GB)"\n    fi\n}\n\ncheck_disk_space\n\n# --- Enhanced Clone with fallbacks ---\nclone_with_fallback() {\n    local url="$1"\n    local target="$2"\n    local max_attempts=3\n    local attempt=1\n    \n    while [[ $attempt -le $max_attempts ]]; do\n        echo "\U0001f504 Clone attempt $attempt of $max_attempts..."\n        \n        if git clone "$url" "$target" 2>&1 | tee clone.log; then\n            echo "\u2705 Repository cloned successfully"\n            rm -f clone.log\n            return 0\n        else\n            local exit_code=$?\n            echo "\u26a0\ufe0f  Clone attempt $attempt failed"\n            \n            # Analyze common errors and provide specific help\n            if [[ $attempt -eq 1 ]]; then\n                if grep -q "SSL certificate problem" clone.log 2>/dev/null; then\n                    echo "\U0001f527 SSL Issue detected. Trying with certificate verification disabled..."\n                    git -c http.sslVerify=false clone "$url" "$target" && return 0\n                elif grep -q "Permission denied" clone.log 2>/dev/null; then\n                    echo "\U0001f527 Permission denied. Checking URL format..."\n                    if [[ "$url" == git@* ]] && ! ssh -T git@github.com 2>&1 | grep -q "successfully authenticated"; then\n                        echo "\U0001f4a1 SSH authentication failed. Try HTTPS URL or add SSH key."\n                    fi\n                elif grep -q "not found" clone.log 2>/dev/null || grep -q "Repository not found" clone.log 2>/dev/null; then\n                    echo "\U0001f4a1 Repository not found. Please verify the URL."\n                fi\n            fi\n            \n            if [[ $attempt -lt $max_attempts ]]; then\n                echo "\u23f3 Waiting 5 seconds before retry..."\n                sleep 5\n            fi\n            ((attempt++))\n        fi\n    done\n    \n    echo "\u274c All clone attempts failed"\n    echo "\U0001f50d Check clone.log for details"\n    exit 1\n}\n\nif [ -d "$PROJECT_PATH" ]; then\n    if [ "$(ls -A "$PROJECT_PATH" 2>/dev/null)" ]; then\n        if [ -d "$PROJECT_PATH/.git" ]; then\n             echo "\U0001f4c1 Repository already exists at $PROJECT_PATH"\n             echo "\U0001f504 Pulling latest changes..."\n             cd "$PROJECT_PATH"\n             git pull origin main 2>/dev/null || git pull origin master 2>/dev/null || echo "\u26a0\ufe0f  Could not pull updates (remote unavailable or different branch)"\n        else\n             echo "\u274c ERROR: Target directory $PROJECT_PATH exists and is not empty."\n             echo "\U0001f4a1 Solutions:"\n             echo "   1. Choose a different project path"\n             echo "   2. Clear the directory manually"\n             echo "   3. Use \'Clear Workspace\' option"\n             exit 1\n        fi\n    else\n        echo "\U0001f4c1 Directory exists but is empty. Proceeding..."\n        mkdir -p "$(dirname "$PROJECT_PATH")"\n        clone_with_fallback "$REPO_URL" "$PROJECT_PATH"\n    fi\nelse\n    echo "\U0001f4e5 Cloning repository to $PROJECT_PATH..."\n    mkdir -p "$(dirname "$PROJECT_PATH")"\n    clone_with_fallback "$REPO_URL" "$PROJECT_PATH"\nfi\n    else\n        echo "Directory exists but is empty. Proceeding..."\n        git clone "$REPO_URL" "$PROJECT_PATH" || { echo "Clone failed."; exit 1; }\n    fi\nelse\n    echo "Cloning repository..."\n    mkdir -p "$(dirname "$PROJECT_PATH")"\n    git clone "$REPO_URL" "$PROJECT_PATH" || { echo "Clone failed. Check your internet connection or URL."; exit 1; }\nfi\ncd "$PROJECT_PATH"\n\n# --- Pre-Install Commands ---\n\n\n# --- Enhanced Virtual Environment Setup ---\ncreate_venv_with_fallback() {\n    local venv_path="$1"\n    local python_cmd="python3"\n    \n    # Try multiple python commands\n    for py_cmd in python3 python3.11 python3.10 python3.9; do\n        if command -v "$py_cmd" >/dev/null 2>&1; then\n            python_cmd="$py_cmd"\n            echo "\U0001f40d Using Python: $python_cmd ($($python_cmd --version))"\n            break\n        fi\n    done\n    \n    # Check if venv module is available\n    if ! $python_cmd -c "import venv" 2>/dev/null; then\n        echo "\u274c ERROR: Python venv module not available"\n        echo "\U0001f4a1 Install with: sudo apt install python3-venv"\n        exit 1\n    fi\n    \n    # Create virtual environment with error handling\n    echo "\U0001f4e6 Creating virtual environment: $venv_path"\n    if $python_cmd -m venv "$venv_path" 2>&1 | tee venv.log; then\n        echo "\u2705 Virtual environment created successfully"\n    else\n        local exit_code=$?\n        echo "\u274c Failed to create virtual environment"\n        \n        # Common issues and solutions\n        if grep -q "ensurepip" venv.log 2>/dev/null; then\n            echo "\U0001f527 ensurepip issue detected. Trying with --system-site-packages..."\n            $python_cmd -m venv "$venv_path" --system-site-packages && return 0\n        elif grep -q "Permission denied" venv.log 2>/dev/null; then\n            echo "\U0001f527 Permission denied. Check directory permissions."\n        fi\n        \n        rm -f venv.log\n        exit $exit_code\n    fi\n    \n    rm -f venv.log\n}\n\nif [ ! -d "$VENV_NAME" ]; then\n    create_venv_with_fallback "$VENV_NAME"\nelse\n    echo "\U0001f4c1 Virtual environment already exists: $VENV_NAME"\nfi\n\n# Activate with validation\nif [ -f "$VENV_NAME/bin/activate" ]; then\n    source "$VENV_NAME/bin/activate"\n    echo "\u2705 Virtual environment activated"\n    \n    # Verify pip is available\n    if ! command -v pip >/dev/null 2>&1; then\n        echo "\U0001f527 Pip not found in venv, reinstalling..."\n        python3 -m ensurepip --default-pip || {\n            echo "\u274c Failed to install pip"\n            exit 1\n        }\n    fi\nelse\n    echo "\u274c ERROR: Cannot find activation script: $VENV_NAME/bin/activate"\n    echo "\U0001f4a1 Virtual environment may be corrupted. Try deleting and recreating."\n    exit 1\nfi\n\n# --- Enhanced Dependencies Installation with Multiple Fallbacks ---\necho "\U0001f4e6 Installing dependencies..."\n\n# Upgrade essential tools with fallbacks\nupgrade_pip_with_fallback() {\n    echo "\U0001f504 Upgrading pip and essential tools..."\n    \n    # Try standard upgrade first\n    if python3 -m pip install --upgrade pip setuptools wheel 2>/dev/null; then\n        echo "\u2705 Pip upgraded successfully"\n        return 0\n    fi\n    \n    # Fallback: Try with --user flag\n    if python3 -m pip install --upgrade --user pip setuptools wheel 2>/dev/null; then\n        echo "\u2705 Pip upgraded (user install)"\n        return 0\n    fi\n    \n    # Fallback: Try without upgrade\n    echo "\u26a0\ufe0f  Standard upgrade failed, trying alternative approach..."\n    python3 -m pip install --no-cache-dir pip setuptools wheel 2>/dev/null || {\n        echo "\u26a0\ufe0f  WARNING: Could not upgrade pip, continuing with existing version"\n    }\n}\n\ninstall_with_fallback() {\n    local install_cmd="$1"\n    local description="$2"\n    local max_attempts=3\n    local attempt=1\n    \n    echo "\U0001f504 Installing $description..."\n    \n    while [[ $attempt -le $max_attempts ]]; do\n        if eval $install_cmd 2>&1 | tee install.log; then\n            echo "\u2705 Successfully installed: $description"\n            rm -f install.log\n            return 0\n        else\n            local exit_code=$?\n            echo "\u26a0\ufe0f  Install attempt $attempt failed for $description"\n            \n            # Analyze common pip errors\n            if [[ $attempt -eq 1 ]]; then\n                if grep -q "network" install.log 2>/dev/null || grep -q "timeout" install.log 2>/dev/null; then\n                    echo "\U0001f527 Network issue detected. Trying with different index..."\n                    eval "${install_cmd/pip install/pip install --index-url https://pypi.org/simple/}" && return 0\n                elif grep -q "build.*failed" install.log 2>/dev/null; then\n                    echo "\U0001f527 Build failure. Trying with pre-compiled wheels..."\n                    eval "${install_cmd/pip install/pip install --only-binary=all}" && return 0\n                elif grep -q "python version" install.log 2>/dev/null; then\n                    echo "\U0001f527 Python version issue. Checking compatibility..."\n                    python3 --version\n                fi\n            fi\n            \n            if [[ $attempt -lt $max_attempts ]]; then\n                echo "\u23f3 Waiting 3 seconds before retry..."\n                sleep 3\n            fi\n            ((attempt++))\n        fi\n    done\n    \n    echo "\u274c Failed to install: $description"\n    echo "\U0001f50d Check install.log for details"\n    return 1\n}\n\nupgrade_pip_with_fallback\n\nINSTALLED_DEPS=false\nFAILED_INSTALLS=""\n\n# 1. Custom Requirements Path (highest priority)\nif [ -n "$CUSTOM_REQ_PATH" ] && [ -f "$CUSTOM_REQ_PATH" ]; then\n    if install_with_fallback "pip install -r "$CUSTOM_REQ_PATH"" "custom requirements"; then\n        INSTALLED_DEPS=true\n    else\n        FAILED_INSTALLS="$FAILED_INSTALLS $CUSTOM_REQ_PATH"\n    fi\nfi\n\n# 1.5 Custom Install Command\nif [ -n "$CUSTOM_INSTALL_CMD" ]; then\n    echo "\U0001f527 Running custom install command..."\n    if install_with_fallback "$CUSTOM_INSTALL_CMD" "custom install command"; then\n        INSTALLED_DEPS=true\n    else\n        FAILED_INSTALLS="$FAILED_INSTALLS custom-command"\n    fi\nfi\n\n# 2. Configured Dependencies (from repos.js)\n\n    # 3. Smart Fallback: Repository-specific logic\n    if [[ "$REPO_URL" == *"edx-platform"* ]]; then\n        echo "\U0001f393 Detected Open edX platform..."\n        [ -f "requirements/pip.txt" ] && install_with_fallback "pip install -r requirements/pip.txt" "Open edX pip requirements" && INSTALLED_DEPS=true\n        [ -f "requirements/edx/base.txt" ] && install_with_fallback "pip install -r requirements/edx/base.txt" "Open edX base requirements" && INSTALLED_DEPS=true\n    fi\n\n    # 4. Enhanced Auto-Discovery with Multiple Patterns\n    if [ "$INSTALLED_DEPS" = false ]; then\n        echo "\U0001f50d Auto-discovering dependency files..."\n        declare -A DEP_PATTERNS=(\n            ["requirements.txt"]="standard requirements"\n            ["requirements/dev.txt"]="development requirements" \n            ["requirements/development.txt"]="development requirements"\n            ["requirements/base.txt"]="base requirements"\n            ["requirements-dev.txt"]="dev requirements (alt)"\n            ["Pipfile"]="Pipfile dependencies"\n            ["pyproject.toml"]="PEP 518 dependencies"\n        )\n        \n        for dep_file in "${!DEP_PATTERNS[@]}"; do\n            if [ -f "$dep_file" ]; then\n                local description="${DEP_PATTERNS[$dep_file]}"\n                \n                case "$dep_file" in\n                    "Pipfile")\n                        if install_with_fallback "pipenv install --deploy" "$description"; then\n                            INSTALLED_DEPS=true\n                            break\n                        fi\n                        ;;\n                    "pyproject.toml")\n                        if install_with_fallback "pip install -e ." "$description"; then\n                            INSTALLED_DEPS=true\n                            break\n                        fi\n                        ;;\n                    *)\n                        if install_with_fallback "pip install -r "$dep_file"" "$description"; then\n                            INSTALLED_DEPS=true\n                            break\n                        fi\n                        ;;\n                esac\n            fi\n        done\n    fi\n\n    # 5. Build System Fallback\n    if [ "$INSTALLED_DEPS" = false ] && ([ -f "setup.py" ] || [ -f "pyproject.toml" ]); then\n        echo "\U0001f528 Detected buildable project, trying installation..."\n        if install_with_fallback "pip install -e ." "editable install"; then\n            INSTALLED_DEPS=true\n        elif install_with_fallback "pip install ." "standard install"; then\n            INSTALLED_DEPS=true\n        fi\n    fi\n\n\n# Final Status and Guidance\nif [ "$INSTALLED_DEPS" = true ]; then\n    echo "\u2705 Dependencies installation completed"\nelse\n    echo "\u26a0\ufe0f  WARNING: Could not install dependencies automatically"\n    echo "\U0001f50d Failed installs: $FAILED_INSTALLS"\n    echo ""\n    echo "\U0001f4a1 Manual installation suggestions:"\n    echo "   1. Check the log files (install.log, venv.log, clone.log)"\n    echo "   2. Try installing manually: pip install -r requirements.txt"\n    echo "   3. Check Python version compatibility"\n    echo "   4. Verify internet connection and DNS"\n    echo ""\n    echo "\U0001f4cb Common solutions:"\n    echo "   - Network issues: pip install --index-url https://pypi.org/simple/"\n    echo "   - Build failures: pip install --only-binary=all"\n    echo "   - Permission errors: Use virtual environment (already created)"\nfi\n\n\n\n# --- Environment ---\necho "Creating .env file..."\ncat > .env << \'EOF\'\n# repo Environment Variables\nDEBUG=True\nSECRET_KEY=dev-secret-key-CHANGE-IN-PROD\nALLOWED_HOSTS=*\n\n# Database\n\nDB_ENGINE=django.db.backends.sqlite3\nDB_NAME=db.sqlite3\nDATABASE_URL=sqlite:///db.sqlite3\n\n\nEOF\n\n# Export vars to ensure they are available for immediate use\nset -a\nsource .env\nset +a\n\n# --- Post-Install Custom Commands ---\n\n\n# --- Framework Specifics ---\n\necho "Running Django specific setup..."\nif [ -f "manage.py" ]; then\n    \n    echo "Initializing database..."\n    \n    python3 manage.py migrate --noinput\n    python3 manage.py compilemessages 2>/dev/null || true\n    \n    \n    \n    echo "Creating Admin User..."\n    export DJANGO_SUPERUSER_PASSWORD="admin123"\n    python3 manage.py createsuperuser || echo "Admin creation failed or user exists."\n    \n    \n    \n    echo "Loading Demo Data..."\n    python3 manage.py loaddata initial_data 2>/dev/null || echo "No \'initial_data\' fixture found."\n    \nelse\n    echo "Warning: manage.py not found!"\nfi\n\n\necho ""\necho "Setup Complete!"\n\necho "Launching Server..."\n"$SCRIPT_DIR/dev-server.sh"\n'

/home/tmo/Downloads/Horilla setup generator app/tests/test_generator.py:522: AssertionError
=========================== short test summary info ============================
FAILED tests/test_generator.py::test_error_handling_trap[chromium] - assert 'trap \'echo "Error encountered at line $LINENO"; exit 1\' ERR' in '#!/bin/bash\n# repo - Development Setup Script\n# Generated: $(date)\n# Enhanced with defensive error handling and fallbacks\n\nset -euo pipefail\ntrap \'echo "\u274c Error encountered at line $LINENO. Exit code: $?" >&2; \n      echo "\U0001f527 Troubleshooting:" >&2\n      echo "  - Check internet connection for git clone" >&2\n      echo "  - Verify Python and pip are working" >&2\n      echo "  - Ensure disk space is available" >&2\n      exit 1\' ERR\n\n# Enhanced error recovery\ntrap \'echo "\u26a0\ufe0f  Script interrupted. Cleaning up..."; \n      # Kill any background processes\n      jobs -p | xargs -r kill 2>/dev/null || true;\n      exit 130\' INT TERM\n\n# --- Configuration with validation ---\nREPO_URL="https://github.com/test/repo.git"\nPROJECT_PATH="~/dev/my-project"\nVENV_NAME="venv"\nCUSTOM_REQ_PATH=""\nCUSTOM_INSTALL_CMD=""\nSCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"\n\n# Validate critical configuration\nif [[ -z "$REPO_URL" ]]; then\n    echo "\u274c ERROR: Repository URL is required" >&2\n    exit 1\nfi\n\nif [[ -z "$PROJECT_PATH" ]]; then\n    echo "\u274c ERROR: Project path is required" >&2\n    exit 1\nfi\n\necho "\U0001f680 Starting setup for repo..."\necho "\U0001f4cd Target directory: $PROJECT_PATH"\n\n# --- Enhanced system checks ---\ncheck_command() {\n    local cmd="$1"\n    local name="$2"\n    local install_hint="$3"\n    \n    if ! command -v "$cmd" >/dev/null 2>&1; then\n        echo "\u274c ERROR: $name is required but not found." >&2\n        if [[ -n "$install_hint" ]]; then\n            echo "\U0001f4a1 Install hint: $install_hint" >&2\n        fi\n        exit 1\n    else\n        echo "\u2705 Found: $name ($(command -v "$cmd"))"\n    fi\n}\n\n# Essential commands\ncheck_command "python3" "Python 3" "sudo apt install python3 python3-pip python3-venv"\ncheck_command "git" "Git" "sudo apt install git"\n\n# Optional but recommended\nif [ -f "package.json" ]; then\n    check_command "npm" "Node.js/NPM" "curl -fsSL https://deb.nodesource.com/setup_lts.x | sudo -E bash - && sudo apt install nodejs"\nfi\n\n# Check disk space (minimum 2GB)\ncheck_disk_space() {\n    local required_gb=2\n    local available_gb=$(df . | tail -1 | awk \'{print int($4/1024/1024)}\')\n    \n    if [[ $available_gb -lt $required_gb ]]; then\n        echo "\u26a0\ufe0f  WARNING: Low disk space (${available_gb}GB available, ${required_gb}GB recommended)"\n        echo "   Setup may fail due to insufficient space." >&2\n        read -p "Continue anyway? (y/N): " -n 1 -r\n        echo\n        if [[ ! $REPLY =~ ^[Yy]$ ]]; then\n            echo "Setup cancelled by user."\n            exit 0\n        fi\n    else\n        echo "\u2705 Sufficient disk space available (${available_gb}GB)"\n    fi\n}\n\ncheck_disk_space\n\n# --- Enhanced Clone with fallbacks ---\nclone_with_fallback() {\n    local url="$1"\n    local target="$2"\n    local max_attempts=3\n    local attempt=1\n    \n    while [[ $attempt -le $max_attempts ]]; do\n        echo "\U0001f504 Clone attempt $attempt of $max_attempts..."\n        \n        if git clone "$url" "$target" 2>&1 | tee clone.log; then\n            echo "\u2705 Repository cloned successfully"\n            rm -f clone.log\n            return 0\n        else\n            local exit_code=$?\n            echo "\u26a0\ufe0f  Clone attempt $attempt failed"\n            \n            # Analyze common errors and provide specific help\n            if [[ $attempt -eq 1 ]]; then\n                if grep -q "SSL certificate problem" clone.log 2>/dev/null; then\n                    echo "\U0001f527 SSL Issue detected. Trying with certificate verification disabled..."\n                    git -c http.sslVerify=false clone "$url" "$target" && return 0\n                elif grep -q "Permission denied" clone.log 2>/dev/null; then\n                    echo "\U0001f527 Permission denied. Checking URL format..."\n                    if [[ "$url" == git@* ]] && ! ssh -T git@github.com 2>&1 | grep -q "successfully authenticated"; then\n                        echo "\U0001f4a1 SSH authentication failed. Try HTTPS URL or add SSH key."\n                    fi\n                elif grep -q "not found" clone.log 2>/dev/null || grep -q "Repository not found" clone.log 2>/dev/null; then\n                    echo "\U0001f4a1 Repository not found. Please verify the URL."\n                fi\n            fi\n            \n            if [[ $attempt -lt $max_attempts ]]; then\n                echo "\u23f3 Waiting 5 seconds before retry..."\n                sleep 5\n            fi\n            ((attempt++))\n        fi\n    done\n    \n    echo "\u274c All clone attempts failed"\n    echo "\U0001f50d Check clone.log for details"\n    exit 1\n}\n\nif [ -d "$PROJECT_PATH" ]; then\n    if [ "$(ls -A "$PROJECT_PATH" 2>/dev/null)" ]; then\n        if [ -d "$PROJECT_PATH/.git" ]; then\n             echo "\U0001f4c1 Repository already exists at $PROJECT_PATH"\n             echo "\U0001f504 Pulling latest changes..."\n             cd "$PROJECT_PATH"\n             git pull origin main 2>/dev/null || git pull origin master 2>/dev/null || echo "\u26a0\ufe0f  Could not pull updates (remote unavailable or different branch)"\n        else\n             echo "\u274c ERROR: Target directory $PROJECT_PATH exists and is not empty."\n             echo "\U0001f4a1 Solutions:"\n             echo "   1. Choose a different project path"\n             echo "   2. Clear the directory manually"\n             echo "   3. Use \'Clear Workspace\' option"\n             exit 1\n        fi\n    else\n        echo "\U0001f4c1 Directory exists but is empty. Proceeding..."\n        mkdir -p "$(dirname "$PROJECT_PATH")"\n        clone_with_fallback "$REPO_URL" "$PROJECT_PATH"\n    fi\nelse\n    echo "\U0001f4e5 Cloning repository to $PROJECT_PATH..."\n    mkdir -p "$(dirname "$PROJECT_PATH")"\n    clone_with_fallback "$REPO_URL" "$PROJECT_PATH"\nfi\n    else\n        echo "Directory exists but is empty. Proceeding..."\n        git clone "$REPO_URL" "$PROJECT_PATH" || { echo "Clone failed."; exit 1; }\n    fi\nelse\n    echo "Cloning repository..."\n    mkdir -p "$(dirname "$PROJECT_PATH")"\n    git clone "$REPO_URL" "$PROJECT_PATH" || { echo "Clone failed. Check your internet connection or URL."; exit 1; }\nfi\ncd "$PROJECT_PATH"\n\n# --- Pre-Install Commands ---\n\n\n# --- Enhanced Virtual Environment Setup ---\ncreate_venv_with_fallback() {\n    local venv_path="$1"\n    local python_cmd="python3"\n    \n    # Try multiple python commands\n    for py_cmd in python3 python3.11 python3.10 python3.9; do\n        if command -v "$py_cmd" >/dev/null 2>&1; then\n            python_cmd="$py_cmd"\n            echo "\U0001f40d Using Python: $python_cmd ($($python_cmd --version))"\n            break\n        fi\n    done\n    \n    # Check if venv module is available\n    if ! $python_cmd -c "import venv" 2>/dev/null; then\n        echo "\u274c ERROR: Python venv module not available"\n        echo "\U0001f4a1 Install with: sudo apt install python3-venv"\n        exit 1\n    fi\n    \n    # Create virtual environment with error handling\n    echo "\U0001f4e6 Creating virtual environment: $venv_path"\n    if $python_cmd -m venv "$venv_path" 2>&1 | tee venv.log; then\n        echo "\u2705 Virtual environment created successfully"\n    else\n        local exit_code=$?\n        echo "\u274c Failed to create virtual environment"\n        \n        # Common issues and solutions\n        if grep -q "ensurepip" venv.log 2>/dev/null; then\n            echo "\U0001f527 ensurepip issue detected. Trying with --system-site-packages..."\n            $python_cmd -m venv "$venv_path" --system-site-packages && return 0\n        elif grep -q "Permission denied" venv.log 2>/dev/null; then\n            echo "\U0001f527 Permission denied. Check directory permissions."\n        fi\n        \n        rm -f venv.log\n        exit $exit_code\n    fi\n    \n    rm -f venv.log\n}\n\nif [ ! -d "$VENV_NAME" ]; then\n    create_venv_with_fallback "$VENV_NAME"\nelse\n    echo "\U0001f4c1 Virtual environment already exists: $VENV_NAME"\nfi\n\n# Activate with validation\nif [ -f "$VENV_NAME/bin/activate" ]; then\n    source "$VENV_NAME/bin/activate"\n    echo "\u2705 Virtual environment activated"\n    \n    # Verify pip is available\n    if ! command -v pip >/dev/null 2>&1; then\n        echo "\U0001f527 Pip not found in venv, reinstalling..."\n        python3 -m ensurepip --default-pip || {\n            echo "\u274c Failed to install pip"\n            exit 1\n        }\n    fi\nelse\n    echo "\u274c ERROR: Cannot find activation script: $VENV_NAME/bin/activate"\n    echo "\U0001f4a1 Virtual environment may be corrupted. Try deleting and recreating."\n    exit 1\nfi\n\n# --- Enhanced Dependencies Installation with Multiple Fallbacks ---\necho "\U0001f4e6 Installing dependencies..."\n\n# Upgrade essential tools with fallbacks\nupgrade_pip_with_fallback() {\n    echo "\U0001f504 Upgrading pip and essential tools..."\n    \n    # Try standard upgrade first\n    if python3 -m pip install --upgrade pip setuptools wheel 2>/dev/null; then\n        echo "\u2705 Pip upgraded successfully"\n        return 0\n    fi\n    \n    # Fallback: Try with --user flag\n    if python3 -m pip install --upgrade --user pip setuptools wheel 2>/dev/null; then\n        echo "\u2705 Pip upgraded (user install)"\n        return 0\n    fi\n    \n    # Fallback: Try without upgrade\n    echo "\u26a0\ufe0f  Standard upgrade failed, trying alternative approach..."\n    python3 -m pip install --no-cache-dir pip setuptools wheel 2>/dev/null || {\n        echo "\u26a0\ufe0f  WARNING: Could not upgrade pip, continuing with existing version"\n    }\n}\n\ninstall_with_fallback() {\n    local install_cmd="$1"\n    local description="$2"\n    local max_attempts=3\n    local attempt=1\n    \n    echo "\U0001f504 Installing $description..."\n    \n    while [[ $attempt -le $max_attempts ]]; do\n        if eval $install_cmd 2>&1 | tee install.log; then\n            echo "\u2705 Successfully installed: $description"\n            rm -f install.log\n            return 0\n        else\n            local exit_code=$?\n            echo "\u26a0\ufe0f  Install attempt $attempt failed for $description"\n            \n            # Analyze common pip errors\n            if [[ $attempt -eq 1 ]]; then\n                if grep -q "network" install.log 2>/dev/null || grep -q "timeout" install.log 2>/dev/null; then\n                    echo "\U0001f527 Network issue detected. Trying with different index..."\n                    eval "${install_cmd/pip install/pip install --index-url https://pypi.org/simple/}" && return 0\n                elif grep -q "build.*failed" install.log 2>/dev/null; then\n                    echo "\U0001f527 Build failure. Trying with pre-compiled wheels..."\n                    eval "${install_cmd/pip install/pip install --only-binary=all}" && return 0\n                elif grep -q "python version" install.log 2>/dev/null; then\n                    echo "\U0001f527 Python version issue. Checking compatibility..."\n                    python3 --version\n                fi\n            fi\n            \n            if [[ $attempt -lt $max_attempts ]]; then\n                echo "\u23f3 Waiting 3 seconds before retry..."\n                sleep 3\n            fi\n            ((attempt++))\n        fi\n    done\n    \n    echo "\u274c Failed to install: $description"\n    echo "\U0001f50d Check install.log for details"\n    return 1\n}\n\nupgrade_pip_with_fallback\n\nINSTALLED_DEPS=false\nFAILED_INSTALLS=""\n\n# 1. Custom Requirements Path (highest priority)\nif [ -n "$CUSTOM_REQ_PATH" ] && [ -f "$CUSTOM_REQ_PATH" ]; then\n    if install_with_fallback "pip install -r "$CUSTOM_REQ_PATH"" "custom requirements"; then\n        INSTALLED_DEPS=true\n    else\n        FAILED_INSTALLS="$FAILED_INSTALLS $CUSTOM_REQ_PATH"\n    fi\nfi\n\n# 1.5 Custom Install Command\nif [ -n "$CUSTOM_INSTALL_CMD" ]; then\n    echo "\U0001f527 Running custom install command..."\n    if install_with_fallback "$CUSTOM_INSTALL_CMD" "custom install command"; then\n        INSTALLED_DEPS=true\n    else\n        FAILED_INSTALLS="$FAILED_INSTALLS custom-command"\n    fi\nfi\n\n# 2. Configured Dependencies (from repos.js)\n\n    # 3. Smart Fallback: Repository-specific logic\n    if [[ "$REPO_URL" == *"edx-platform"* ]]; then\n        echo "\U0001f393 Detected Open edX platform..."\n        [ -f "requirements/pip.txt" ] && install_with_fallback "pip install -r requirements/pip.txt" "Open edX pip requirements" && INSTALLED_DEPS=true\n        [ -f "requirements/edx/base.txt" ] && install_with_fallback "pip install -r requirements/edx/base.txt" "Open edX base requirements" && INSTALLED_DEPS=true\n    fi\n\n    # 4. Enhanced Auto-Discovery with Multiple Patterns\n    if [ "$INSTALLED_DEPS" = false ]; then\n        echo "\U0001f50d Auto-discovering dependency files..."\n        declare -A DEP_PATTERNS=(\n            ["requirements.txt"]="standard requirements"\n            ["requirements/dev.txt"]="development requirements" \n            ["requirements/development.txt"]="development requirements"\n            ["requirements/base.txt"]="base requirements"\n            ["requirements-dev.txt"]="dev requirements (alt)"\n            ["Pipfile"]="Pipfile dependencies"\n            ["pyproject.toml"]="PEP 518 dependencies"\n        )\n        \n        for dep_file in "${!DEP_PATTERNS[@]}"; do\n            if [ -f "$dep_file" ]; then\n                local description="${DEP_PATTERNS[$dep_file]}"\n                \n                case "$dep_file" in\n                    "Pipfile")\n                        if install_with_fallback "pipenv install --deploy" "$description"; then\n                            INSTALLED_DEPS=true\n                            break\n                        fi\n                        ;;\n                    "pyproject.toml")\n                        if install_with_fallback "pip install -e ." "$description"; then\n                            INSTALLED_DEPS=true\n                            break\n                        fi\n                        ;;\n                    *)\n                        if install_with_fallback "pip install -r "$dep_file"" "$description"; then\n                            INSTALLED_DEPS=true\n                            break\n                        fi\n                        ;;\n                esac\n            fi\n        done\n    fi\n\n    # 5. Build System Fallback\n    if [ "$INSTALLED_DEPS" = false ] && ([ -f "setup.py" ] || [ -f "pyproject.toml" ]); then\n        echo "\U0001f528 Detected buildable project, trying installation..."\n        if install_with_fallback "pip install -e ." "editable install"; then\n            INSTALLED_DEPS=true\n        elif install_with_fallback "pip install ." "standard install"; then\n            INSTALLED_DEPS=true\n        fi\n    fi\n\n\n# Final Status and Guidance\nif [ "$INSTALLED_DEPS" = true ]; then\n    echo "\u2705 Dependencies installation completed"\nelse\n    echo "\u26a0\ufe0f  WARNING: Could not install dependencies automatically"\n    echo "\U0001f50d Failed installs: $FAILED_INSTALLS"\n    echo ""\n    echo "\U0001f4a1 Manual installation suggestions:"\n    echo "   1. Check the log files (install.log, venv.log, clone.log)"\n    echo "   2. Try installing manually: pip install -r requirements.txt"\n    echo "   3. Check Python version compatibility"\n    echo "   4. Verify internet connection and DNS"\n    echo ""\n    echo "\U0001f4cb Common solutions:"\n    echo "   - Network issues: pip install --index-url https://pypi.org/simple/"\n    echo "   - Build failures: pip install --only-binary=all"\n    echo "   - Permission errors: Use virtual environment (already created)"\nfi\n\n\n\n# --- Environment ---\necho "Creating .env file..."\ncat > .env << \'EOF\'\n# repo Environment Variables\nDEBUG=True\nSECRET_KEY=dev-secret-key-CHANGE-IN-PROD\nALLOWED_HOSTS=*\n\n# Database\n\nDB_ENGINE=django.db.backends.sqlite3\nDB_NAME=db.sqlite3\nDATABASE_URL=sqlite:///db.sqlite3\n\n\nEOF\n\n# Export vars to ensure they are available for immediate use\nset -a\nsource .env\nset +a\n\n# --- Post-Install Custom Commands ---\n\n\n# --- Framework Specifics ---\n\necho "Running Django specific setup..."\nif [ -f "manage.py" ]; then\n    \n    echo "Initializing database..."\n    \n    python3 manage.py migrate --noinput\n    python3 manage.py compilemessages 2>/dev/null || true\n    \n    \n    \n    echo "Creating Admin User..."\n    export DJANGO_SUPERUSER_PASSWORD="admin123"\n    python3 manage.py createsuperuser || echo "Admin creation failed or user exists."\n    \n    \n    \n    echo "Loading Demo Data..."\n    python3 manage.py loaddata initial_data 2>/dev/null || echo "No \'initial_data\' fixture found."\n    \nelse\n    echo "Warning: manage.py not found!"\nfi\n\n\necho ""\necho "Setup Complete!"\n\necho "Launching Server..."\n"$SCRIPT_DIR/dev-server.sh"\n'
============================== 1 failed in 2.39s ===============================
